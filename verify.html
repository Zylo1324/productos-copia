<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#f6f7fb" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0b1420" media="(prefers-color-scheme: dark)">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="color-scheme" content="light dark" />
  <title>Verifica tu correo • Zyl0</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js"
      }
    }
  </script>
  <style>
    :root{
      color-scheme:light;
      --bg-light:#f6f7fb;
      --bg-dark:#0b1420;
      --bg:#f8fafc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --primary:#f28a2d;
      --accent:#1d4ed8;

      --ink:var(--text);
      --ink-soft:color-mix(in srgb,var(--text) 78%,var(--bg));
      --field:var(--card);
      --field-focus:color-mix(in srgb,var(--card) 88%,var(--bg));
      --border:color-mix(in srgb,var(--muted) 32%,transparent);
      --pill-bg:color-mix(in srgb,var(--accent) 14%,transparent);
      --pill-ink:var(--accent);
      --btn:var(--primary);
      --btn-ink:#1c130a;
      --primary-hover:color-mix(in srgb,var(--primary) 92%,var(--card));
      --primary-active:color-mix(in srgb,var(--primary) 88%,var(--muted));
      --ghost:color-mix(in srgb,var(--card) 86%,var(--bg));
      --ghost-border:color-mix(in srgb,var(--muted) 38%,transparent);
      --ghost-hover-bg:color-mix(in srgb,var(--ghost) 80%,var(--accent) 20%);
      --ghost-active-bg:color-mix(in srgb,var(--ghost) 68%,var(--accent) 32%);
      --ghost-hover-border:color-mix(in srgb,var(--accent) 38%,transparent);
      --ghost-active-border:color-mix(in srgb,var(--accent) 48%,transparent);
      --ok:#4ade80;
      --warn:#fbbf24;
      --bad:#fb7185;
      --link:#2563eb;
      --link-hover:color-mix(in srgb,var(--accent) 35%,var(--bg));
      --link-active:color-mix(in srgb,var(--accent) 55%,var(--bg));
      --success:#16f2a6;
      --danger:#f97373;
      --shadow:0 4px 12px color-mix(in srgb,var(--text) 12%,transparent);
      --shadow-strong:0 12px 28px color-mix(in srgb,var(--text) 18%,transparent);
      --shadow-float:0 10px 20px color-mix(in srgb,var(--text) 22%,transparent);
      --primary-shadow:0 8px 18px color-mix(in srgb,var(--primary) 28%,transparent);
      --panel-shadow-lg:0 20px 38px -24px color-mix(in srgb,var(--text) 24%,transparent);
      --toolbar-bg:color-mix(in srgb,var(--card) 92%,transparent);
      --input-bg:var(--card);
      --input-border:color-mix(in srgb,var(--muted) 42%,transparent);
      --input-focus-border:color-mix(in srgb,var(--accent) 48%,transparent);
      --input-focus-shadow:color-mix(in srgb,var(--accent) 18%,transparent);
      --input-inner-shadow:inset 0 1px 0 color-mix(in srgb,var(--muted) 16%,transparent);
      --ghost-inner-shadow:inset 0 1px 0 color-mix(in srgb,var(--card) 60%,transparent);
      --surface-inner-shadow:inset 0 1px 0 color-mix(in srgb,var(--muted) 12%,transparent);
      --card-bg:var(--card);
      --table-card-bg:var(--card);
      --table-border:color-mix(in srgb,var(--muted) 24%,transparent);
      --table-row-alt-bg:color-mix(in srgb,var(--bg) 74%,var(--accent) 26%);
      --table-row-hover-bg:color-mix(in srgb,var(--accent) 16%,transparent);
      --table-row-hover-shadow:inset 0 0 0 999px color-mix(in srgb,var(--text) 8%,transparent);
      --menu-bg:var(--card);
      --menu-hover-bg:color-mix(in srgb,var(--bg) 86%,var(--accent) 14%);
      --modal-bg:var(--card);
      --backdrop-bg:color-mix(in srgb,var(--text) 35%,transparent);
      --chat-log-bg:var(--bg);
      --ai-bubble-bg:color-mix(in srgb,var(--card) 88%,var(--bg));
      --ai-bubble-border:color-mix(in srgb,var(--muted) 32%,transparent);
      --eye-bg:color-mix(in srgb,var(--card) 82%,var(--bg));
      --eye-border:color-mix(in srgb,var(--muted) 52%,transparent);
      --addserv-bg:color-mix(in srgb,var(--accent) 28%,var(--bg));
      --addserv-border:color-mix(in srgb,var(--accent) 45%,transparent);
      --addserv-hover-bg:color-mix(in srgb,var(--accent) 32%,var(--bg));
      --addserv-hover-border:color-mix(in srgb,var(--accent) 55%,transparent);
      --addserv-active-bg:color-mix(in srgb,var(--accent) 38%,var(--bg));
      --addserv-active-border:color-mix(in srgb,var(--accent) 65%,transparent);
      --addserv-ink:var(--accent);
      --tag-border:color-mix(in srgb,var(--muted) 36%,transparent);
      --tag-bg:color-mix(in srgb,var(--bg) 82%,var(--muted) 18%);
      --tag-ok-bg:color-mix(in srgb,var(--ok) 18%,transparent);
      --tag-ok-border:color-mix(in srgb,var(--ok) 38%,transparent);
      --tag-warn-bg:color-mix(in srgb,var(--warn) 18%,transparent);
      --tag-warn-border:color-mix(in srgb,var(--warn) 38%,transparent);
      --tag-bad-bg:color-mix(in srgb,var(--bad) 18%,transparent);
      --tag-bad-border:color-mix(in srgb,var(--bad) 40%,transparent);
      --danger-soft-ink:color-mix(in srgb,var(--bad) 26%,var(--card));
      --logo-highlight:color-mix(in srgb,var(--primary) 55%,var(--warn) 45%);
      --launcher-grad:linear-gradient(150deg,var(--card) 0%,color-mix(in srgb,var(--card) 82%,var(--accent) 18%) 100%);
      --sidebar-grad:linear-gradient(180deg,var(--card) 0%,color-mix(in srgb,var(--card) 80%,var(--bg)) 100%);
      --panel-grad:linear-gradient(180deg,var(--card) 0%,color-mix(in srgb,var(--card) 78%,var(--bg)) 100%);
      --chat-grad:linear-gradient(180deg,var(--bg) 0%,color-mix(in srgb,var(--bg) 86%,var(--muted)) 100%);
      --tag-grad:linear-gradient(135deg,color-mix(in srgb,var(--bg) 92%,var(--muted) 8%) 0%,color-mix(in srgb,var(--bg) 82%,var(--muted) 18%) 100%);
      --table-hover-shadow:inset 0 0 0 999px color-mix(in srgb,var(--accent) 12%,transparent);
      --launcher-focus-outline:color-mix(in srgb,var(--accent) 35%,transparent);
      --action-focus-outline:color-mix(in srgb,var(--accent) 45%,transparent);
      --danger-ghost-bg:color-mix(in srgb,var(--bad) 18%,transparent);
      --danger-ghost-border:color-mix(in srgb,var(--bad) 45%,transparent);
      --danger-ghost-active:color-mix(in srgb,var(--bad) 32%,transparent);
      --menu-danger-bg:color-mix(in srgb,var(--bad) 12%,transparent);
      --menu-danger-border:color-mix(in srgb,var(--bad) 35%,transparent);
      --modal-grad:linear-gradient(180deg,var(--card) 0%,color-mix(in srgb,var(--card) 74%,var(--bg)) 100%);
      --user-bubble-grad:linear-gradient(135deg,var(--primary) 0%,color-mix(in srgb,var(--primary) 80%,var(--warn)) 100%);
      --user-bubble-shadow:0 8px 18px color-mix(in srgb,var(--primary) 28%,transparent);
      --ai-bubble-shadow:0 8px 18px color-mix(in srgb,var(--text) 18%,transparent);
      --radial-accent:color-mix(in srgb,var(--accent) 24%,transparent);
      --radial-success:color-mix(in srgb,var(--success) 18%,transparent);
      --radial-primary:color-mix(in srgb,var(--primary) 18%,transparent);
      --scrollbar-thumb:color-mix(in srgb,var(--accent) 65%,transparent);
      --scrollbar-track:transparent;
      font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;
    }

    @media(prefers-color-scheme:dark){
      :root{
        color-scheme:dark;
        --bg-light:#f6f7fb;
        --bg-dark:#0b1420;
        --bg:#020617;
        --card:#111827;
        --text:#e2e8f0;
        --muted:#94a3b8;
        --primary:#f59e0b;
        --accent:#60a5fa;
        --btn-ink:#1a1205;
        --ok:#34d399;
        --warn:#fbbf24;
        --bad:#fb7185;
        --link:#93c5fd;
        --success:#16f2a6;
        --danger:#fb7185;
        --logo-highlight:color-mix(in srgb,var(--primary) 45%,var(--warn) 55%);
      }
    }

    html[data-theme="light"]{
      color-scheme:light;
      --bg:#f8fafc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --primary:#f28a2d;
      --accent:#1d4ed8;
      --btn-ink:#1c130a;
      --ok:#4ade80;
      --warn:#fbbf24;
      --bad:#fb7185;
      --link:#2563eb;
      --success:#16f2a6;
      --danger:#f97373;
      --logo-highlight:color-mix(in srgb,var(--primary) 55%,var(--warn) 45%);
    }

    html[data-theme="dark"]{
      color-scheme:dark;
      --bg:#020617;
      --card:#111827;
      --text:#e2e8f0;
      --muted:#94a3b8;
      --primary:#f59e0b;
      --accent:#60a5fa;
      --btn-ink:#1a1205;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --link:#93c5fd;
      --success:#16f2a6;
      --danger:#fb7185;
      --logo-highlight:color-mix(in srgb,var(--primary) 45%,var(--warn) 55%);
    }
    *{box-sizing:border-box;font-family:inherit;}
    html,body{background-color:var(--bg-light);}
    @media(prefers-color-scheme:dark){html,body{background-color:var(--bg-dark);}}
    body{
      margin:0;
      min-height:100vh;
      color:var(--ink);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:48px 16px;
      background-color:var(--bg-light);
      background:
        radial-gradient(circle at 24% 18%,color-mix(in srgb,var(--accent) 28%,transparent),transparent 56%),
        radial-gradient(circle at 78% 80%,color-mix(in srgb,var(--muted) 26%,transparent),transparent 60%),
        linear-gradient(180deg,var(--bg) 0%,color-mix(in srgb,var(--bg) 70%,var(--muted)) 100%);
    }
    main{
      width:min(480px,100%);
    }
    .panel{
      background:var(--toolbar-bg);
      border:1px solid var(--border);
      border-radius:22px;
      padding:32px;
      display:grid;
      gap:20px;
      box-shadow:var(--panel-shadow-lg);
    }
    h1{margin:0;font-size:28px;}
    p{margin:0;color:var(--muted);line-height:1.5;}
    .email{
      font-weight:600;
      color:var(--ink);
      word-break:break-word;
    }
    .status{
      min-height:20px;
      font-size:14px;
      color:var(--muted);
    }
    .status[data-tone="success"]{color:var(--success);}
    .status[data-tone="danger"]{color:var(--danger);}
    .status[data-tone="info"]{color:var(--link);}
    .actions{display:flex;gap:12px;flex-wrap:wrap;}
    button{
      border:0;
      border-radius:14px;
      padding:10px 18px;
      cursor:pointer;
      font-weight:600;
      transition:background-color .2s ease,transform .2s ease,box-shadow .2s ease;
    }
    .primary{background:var(--btn);color:var(--btn-ink);box-shadow:var(--primary-shadow);}
    .ghost{background:var(--ghost);color:var(--ink);border:1px solid var(--ghost-border);box-shadow:var(--ghost-inner-shadow);}
    button:hover:not(:disabled),button:focus-visible:not(:disabled){transform:translateY(-1px);box-shadow:var(--shadow-float);}
    button:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none;}
    @media(max-width:520px){
      body{padding:36px 14px;}
      .panel{padding:28px;}
    }
  </style>
</head>
<body>
  <main>
    <article class="panel" aria-labelledby="verifyTitle">
      <header>
        <h1 id="verifyTitle">Verifica tu correo</h1>
        <p>Confirma tu dirección de correo para acceder al panel de productos.</p>
      </header>
      <section>
        <p>Estamos esperando a que confirmes la dirección:</p>
        <p class="email" data-user-email>–</p>
      </section>
      <p class="status" data-status data-tone="info"></p>
      <div class="actions">
        <button type="button" class="primary" id="btnCheck">Ya lo verifiqué</button>
        <button type="button" class="ghost" id="btnResend">Reenviar correo</button>
        <button type="button" class="ghost" id="btnSignOut">Cerrar sesión</button>
      </div>
    </article>
  </main>

  <script type="module">
    import { auth } from './firebaseConfig.js';
    import {
      onAuthStateChanged,
      sendEmailVerification,
      signOut
    } from 'firebase/auth';

    const emailEl = document.querySelector('[data-user-email]');
    const statusEl = document.querySelector('[data-status]');
    const btnCheck = document.getElementById('btnCheck');
    const btnResend = document.getElementById('btnResend');
    const btnSignOut = document.getElementById('btnSignOut');
    const buttons = [btnCheck, btnResend, btnSignOut];

    function setStatus(message = '', tone = 'info') {
      if (!statusEl) return;
      statusEl.textContent = message;
      statusEl.dataset.tone = tone;
    }

    function setProcessing(isProcessing) {
      buttons.forEach(btn => {
        if (btn) {
          btn.disabled = isProcessing;
        }
      });
    }

    onAuthStateChanged(auth, user => {
      if (!user) {
        window.location.href = 'login.html';
        return;
      }
      emailEl.textContent = user.email || 'Sin correo registrado';
      if (user.emailVerified) {
        window.location.href = 'index.html';
      }
    });

    btnCheck?.addEventListener('click', async () => {
      setProcessing(true);
      setStatus('Revisando verificación…', 'info');
      try {
        await auth.currentUser?.reload();
        const user = auth.currentUser;
        if (user?.emailVerified) {
          setStatus('Correo verificado. Redirigiendo…', 'success');
          window.location.href = 'index.html';
          return;
        }
        setStatus('Todavía no vemos la confirmación. Revisa tu correo o inténtalo de nuevo en unos segundos.', 'danger');
      } catch (error) {
        console.error(error);
        setStatus(error?.message || 'No se pudo comprobar el estado de verificación.', 'danger');
      } finally {
        setProcessing(false);
      }
    });

    btnResend?.addEventListener('click', async () => {
      setProcessing(true);
      setStatus('Enviando un nuevo correo de verificación…', 'info');
      try {
        const user = auth.currentUser;
        if (!user) {
          throw new Error('No hay una sesión activa.');
        }
        await sendEmailVerification(user);
        setStatus('Te enviamos un nuevo correo de verificación. Revisa tu bandeja de entrada.', 'success');
      } catch (error) {
        console.error(error);
        setStatus(error?.message || 'No se pudo reenviar el correo. Intenta más tarde.', 'danger');
      } finally {
        setProcessing(false);
      }
    });

    btnSignOut?.addEventListener('click', async () => {
      setProcessing(true);
      setStatus('Cerrando sesión…', 'info');
      try {
        await signOut(auth);
        window.location.href = 'login.html';
      } catch (error) {
        console.error(error);
        setStatus(error?.message || 'No se pudo cerrar la sesión.', 'danger');
        setProcessing(false);
      }
    });
  </script>
</body>
</html>
